<!DOCTYPE html>
<link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Open+Sans" />
<link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Droid+Sans+Mono" />
<link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/octicons/3.0.1/octicons.min.css"/>
<link rel="stylesheet" type="text/css" href="main.css" />
<body><header>
  <a href="index.html">maybe-hugs</a>
</header>
<nav>
  <a href="bash.html">bash</a>
  <a href="c.html">c</a>
  <a href="cplusplus.html">c++</a>
  <a href="clojure.html">clojure</a>
  <a href="commonlisp.html">commonlisp</a>
  <a href="csharp.html">csharp</a>
  <a href="elixir.html">elixir</a>
  <a href="elm.html">elm</a>
  <a href="erlang.html">erlang</a>
  <a href="go.html">go</a>
  <a href="haskell.html">haskell</a>
  <a href="hy.html">hy</a>
  <a href="idris.html">idris</a>
  <a href="java.html">java</a>
  <a href="javascript.html">javascript</a>
  <a href="ocaml.html">ocaml</a>
  <a href="ocaml-cps.html">ocaml-cps</a>
  <a href="perl.html">perl</a>
  <a href="perl6.html">perl6</a>
  <a href="php.html">php</a>
  <a href="purescript.html">purescript</a>
  <a href="python.html">python</a>
  <a href="racket.html">racket</a>
  <a href="ruby.html">ruby</a>
  <a href="rust.html">rust</a>
  <a href="sass.html">sass</a>
  <a href="scala.html">scala</a>
</nav>
  <div id="container">

    <main>
      <h2 id="user-content-ocaml-cps" class="deep-link"><a href="#ocaml-cps">ocaml-cps</a></h2>
<h6 id="user-content-gitignore" class="deep-link"><a href="#gitignore">.gitignore</a></h6>
<pre class="editor editor-colors"><div class="line"><span class="text"><span>test.byte</span></span></div><div class="line"><span class="text"><span>_build</span></span></div><div class="line"><span class="text"><span>&#xA0;</span></span></div></pre>
<h6 id="user-content-makefile" class="deep-link"><a href="#makefile">Makefile</a></h6>
<pre class="editor editor-colors"><div class="line"><span class="text"><span>.PHONY&#xA0;:&#xA0;all&#xA0;clean</span></span></div><div class="line"><span class="text"><span>&#xA0;</span></span></div><div class="line"><span class="text"><span>all&#xA0;:</span></span></div><div class="line"><span class="text"><span>	ocamlbuild&#xA0;-lib&#xA0;unix&#xA0;test.byte</span></span></div><div class="line"><span class="text"><span>&#xA0;</span></span></div><div class="line"><span class="text"><span>clean&#xA0;:</span></span></div><div class="line"><span class="text"><span>	rm&#xA0;-rf&#xA0;_build&#xA0;test.byte</span></span></div><div class="line"><span class="text"><span>&#xA0;</span></span></div></pre>
<h6 id="user-content-huggableml" class="deep-link"><a href="#huggableml">huggable.ml</a></h6>
<pre class="editor editor-colors"><div class="line"><span class="text"><span>(*&#xA0;A&#xA0;functional&#xA0;implementation&#xA0;of&#xA0;asking&#xA0;about&#xA0;and&#xA0;giving&#xA0;hugs.&#xA0;*)</span></span></div><div class="line"><span class="text"><span>&#xA0;</span></span></div><div class="line"><span class="text"><span>(*&#xA0;When&#xA0;someone&#xA0;says&#xA0;it&apos;s&#xA0;OK&#xA0;to&#xA0;hug,&#xA0;that&#xA0;doesn&apos;t&#xA0;mean&#xA0;it&apos;s&#xA0;forever&#xA0;OK&#xA0;*)</span></span></div><div class="line"><span class="text"><span>type&#xA0;time&#xA0;=&#xA0;float</span></span></div><div class="line"><span class="text"><span>let&#xA0;reasonable_hug_limit&#xA0;=&#xA0;30.0&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;(*&#xA0;seconds&#xA0;*)</span></span></div><div class="line"><span class="text"><span>let&#xA0;is_reasonably_timed&#xA0;t&#xA0;=&#xA0;(t&#xA0;+.&#xA0;reasonable_hug_limit)&#xA0;&gt;&#xA0;Unix.time()</span></span></div><div class="line"><span class="text"><span>&#xA0;</span></span></div><div class="line"><span class="text"><span>(*&#xA0;Possible&#xA0;kinds&#xA0;of&#xA0;huggability&#xA0;*)</span></span></div><div class="line"><span class="text"><span>type&#xA0;huggability&#xA0;=</span></span></div><div class="line"><span class="text"><span>&#xA0;&#xA0;|&#xA0;Unknown</span></span></div><div class="line"><span class="text"><span>&#xA0;&#xA0;|&#xA0;Empathetic</span></span></div><div class="line"><span class="text"><span>&#xA0;&#xA0;|&#xA0;Huggable</span></span></div><div class="line"><span class="text"><span>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;</span></span></div><div class="line"><span class="text"><span>(*&#xA0;Representation&#xA0;of&#xA0;what&#xA0;we&#xA0;know&#xA0;about&#xA0;a&#xA0;person&apos;s&#xA0;(value&apos;s)&#xA0;huggability.&#xA0;*)</span></span></div><div class="line"><span class="text"><span>&#xA0;</span></span></div><div class="line"><span class="text"><span>type&#xA0;&apos;a&#xA0;t&#xA0;=&#xA0;&apos;a&#xA0;*&#xA0;huggability&#xA0;*&#xA0;time</span></span></div><div class="line"><span class="text"><span>&#xA0;</span></span></div><div class="line"><span class="text"><span>(*&#xA0;If&#xA0;we&apos;ve&#xA0;just&#xA0;met,&#xA0;we&#xA0;don&apos;t&#xA0;known&#xA0;if&#xA0;they&#xA0;accept&#xA0;hugs.&#xA0;*)</span></span></div><div class="line"><span class="text"><span>&#xA0;</span></span></div><div class="line"><span class="text"><span>let&#xA0;make&#xA0;x&#xA0;=&#xA0;(x,&#xA0;Unknown,&#xA0;0.0)</span></span></div><div class="line"><span class="text"><span>&#xA0;</span></span></div><div class="line"><span class="text"><span>(*&#xA0;For&#xA0;some&#xA0;reason,&#xA0;values&#xA0;decide&#xA0;whether&#xA0;they&apos;re&#xA0;huggable&#xA0;based&#xA0;on</span></span></div><div class="line"><span class="text"><span>&#xA0;&#xA0;&#xA0;the&#xA0;low&#xA0;bit&#xA0;of&#xA0;their&#xA0;hash.&#xA0;*)</span></span></div><div class="line"><span class="text"><span>&#xA0;</span></span></div><div class="line"><span class="text"><span>let&#xA0;agrees_to_hugs&#xA0;x&#xA0;=&#xA0;(Hashtbl.hash&#xA0;x&#xA0;land&#xA0;0x01)&#xA0;==&#xA0;0x01</span></span></div><div class="line"><span class="text"><span>&#xA0;</span></span></div><div class="line"><span class="text"><span>(*&#xA0;Ask&#xA0;if&#xA0;someone&#xA0;accepts&#xA0;hugs,&#xA0;and&#xA0;return&#xA0;the&#xA0;new&#xA0;state&#xA0;of&#xA0;our&#xA0;knowledge.&#xA0;*)</span></span></div><div class="line"><span class="text"><span>&#xA0;</span></span></div><div class="line"><span class="text"><span>let&#xA0;ask_if_hugs&#xA0;(x,&#xA0;_,&#xA0;_)&#xA0;=&#xA0;</span></span></div><div class="line"><span class="text"><span>&#xA0;&#xA0;if&#xA0;agrees_to_hugs&#xA0;x</span></span></div><div class="line"><span class="text"><span>&#xA0;&#xA0;&#xA0;&#xA0;then&#xA0;(x,&#xA0;Huggable,&#xA0;Unix.time())&#xA0;&#xA0;&#xA0;&#xA0;(*&#xA0;keep&#xA0;track&#xA0;of&#xA0;when&#xA0;we&#xA0;asked&#xA0;*)</span></span></div><div class="line"><span class="text"><span>&#xA0;&#xA0;&#xA0;&#xA0;else&#xA0;(x,&#xA0;Empathetic,&#xA0;Unix.time())</span></span></div><div class="line"><span class="text"><span>&#xA0;</span></span></div><div class="line"><span class="text"><span>(*&#xA0;Do&#xA0;something&#xA0;different&#xA0;depending&#xA0;on&#xA0;what&#xA0;we&#xA0;know&#xA0;of&#xA0;whether&#xA0;a&#xA0;person</span></span></div><div class="line"><span class="text"><span>&#xA0;&#xA0;&#xA0;accepts&#xA0;hugs.&#xA0;&quot;kh&quot;&#xA0;is&#xA0;called&#xA0;if&#xA0;they&#xA0;do,&#xA0;&quot;ke&quot;&#xA0;if&#xA0;they&#xA0;do&#xA0;not,&#xA0;and</span></span></div><div class="line"><span class="text"><span>&#xA0;&#xA0;&#xA0;&quot;ku&quot;&#xA0;if&#xA0;we&#xA0;have&#xA0;not&#xA0;asked&#xA0;recently.&#xA0;*)</span></span></div><div class="line"><span class="text"><span>&#xA0;</span></span></div><div class="line"><span class="text"><span>let&#xA0;maybe_hug&#xA0;kh&#xA0;ke&#xA0;ku&#xA0;=&#xA0;function</span></span></div><div class="line"><span class="text"><span>&#xA0;&#xA0;|&#xA0;(x,&#xA0;Unknown,&#xA0;_)&#xA0;-&gt;&#xA0;ku&#xA0;x</span></span></div><div class="line"><span class="text"><span>&#xA0;&#xA0;|&#xA0;(x,&#xA0;Empathetic,&#xA0;t)&#xA0;when&#xA0;is_reasonably_timed&#xA0;t&#xA0;-&gt;&#xA0;ke&#xA0;x</span></span></div><div class="line"><span class="text"><span>&#xA0;&#xA0;|&#xA0;(x,&#xA0;Huggable,&#xA0;t)&#xA0;when&#xA0;is_reasonably_timed&#xA0;t&#xA0;-&gt;&#xA0;kh&#xA0;x</span></span></div><div class="line"><span class="text"><span>&#xA0;&#xA0;|&#xA0;(x,&#xA0;_,&#xA0;_)&#xA0;-&gt;&#xA0;ku&#xA0;x&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;(*&#xA0;you&#xA0;should&#xA0;ask&#xA0;again&#xA0;*)</span></span></div><div class="line"><span class="text"><span>&#xA0;</span></span></div></pre>
<h6 id="user-content-huggablemli" class="deep-link"><a href="#huggablemli">huggable.mli</a></h6>
<pre class="editor editor-colors"><div class="line"><span class="text"><span>(*</span></span></div><div class="line"><span class="text"><span>&#xA0;</span></span></div><div class="line"><span class="text"><span>Huggable:</span></span></div><div class="line"><span class="text"><span>&#xA0;&#xA0;Some&#xA0;people&#xA0;(values)&#xA0;like&#xA0;hugs.</span></span></div><div class="line"><span class="text"><span>&#xA0;&#xA0;Some&#xA0;people&#xA0;(values)&#xA0;do&#xA0;not.</span></span></div><div class="line"><span class="text"><span>&#xA0;&#xA0;You&#xA0;should&#xA0;ask&#xA0;a&#xA0;person&#xA0;before&#xA0;you&#xA0;try&#xA0;to&#xA0;hug&#xA0;them.</span></span></div><div class="line"><span class="text"><span>&#xA0;&#xA0;You&#xA0;should&#xA0;do&#xA0;different&#xA0;things&#xA0;depending&#xA0;on&#xA0;what&#xA0;you&#xA0;know&#xA0;about</span></span></div><div class="line"><span class="text"><span>&#xA0;&#xA0;&#xA0;&#xA0;how&#xA0;they&#xA0;would&#xA0;like&#xA0;to&#xA0;be&#xA0;treated.</span></span></div><div class="line"><span class="text"><span>&#xA0;&#xA0;You&#xA0;should&#xA0;check&#xA0;again&#xA0;to&#xA0;see&#xA0;if&#xA0;the&#xA0;answer&#xA0;has&#xA0;changed&#xA0;if&#xA0;it&apos;s</span></span></div><div class="line"><span class="text"><span>&#xA0;&#xA0;&#xA0;&#xA0;been&#xA0;a&#xA0;while&#xA0;since&#xA0;you&#xA0;last&#xA0;asked.</span></span></div><div class="line"><span class="text"><span>&#xA0;</span></span></div><div class="line"><span class="text"><span>*)</span></span></div><div class="line"><span class="text"><span>&#xA0;</span></span></div><div class="line"><span class="text"><span>(*&#xA0;A&#xA0;data&#xA0;type&#xA0;to&#xA0;keep&#xA0;track&#xA0;of&#xA0;whether&#xA0;a&#xA0;person&#xA0;(value)&#xA0;is&#xA0;huggable,&#xA0;and</span></span></div><div class="line"><span class="text"><span>&#xA0;&#xA0;&#xA0;whether&#xA0;they&apos;ve&#xA0;been&#xA0;asked&#xA0;*)</span></span></div><div class="line"><span class="text"><span>&#xA0;</span></span></div><div class="line"><span class="text"><span>type&#xA0;&apos;a&#xA0;t</span></span></div><div class="line"><span class="text"><span>&#xA0;</span></span></div><div class="line"><span class="text"><span>(*&#xA0;make&#xA0;x</span></span></div><div class="line"><span class="text"><span>&#xA0;&#xA0;&#xA0;Take&#xA0;a&#xA0;value&#xA0;x&#xA0;and&#xA0;return&#xA0;a&#xA0;Huggable.t&#xA0;for&#xA0;it&#xA0;*)</span></span></div><div class="line"><span class="text"><span>&#xA0;</span></span></div><div class="line"><span class="text"><span>val&#xA0;make&#xA0;:&#xA0;&apos;a&#xA0;-&gt;&#xA0;&apos;a&#xA0;t</span></span></div><div class="line"><span class="text"><span>&#xA0;</span></span></div><div class="line"><span class="text"><span>(*&#xA0;ask_if_hugs&#xA0;h</span></span></div><div class="line"><span class="text"><span>&#xA0;&#xA0;&#xA0;Take&#xA0;a&#xA0;Huggable.t&#xA0;and&#xA0;ask&#xA0;the&#xA0;value&#xA0;if&#xA0;they&#xA0;hug,&#xA0;and&#xA0;remember&#xA0;that</span></span></div><div class="line"><span class="text"><span>&#xA0;&#xA0;&#xA0;in&#xA0;the&#xA0;new&#xA0;Huggable.t&#xA0;that&#xA0;is&#xA0;returned.&#xA0;*)</span></span></div><div class="line"><span class="text"><span>&#xA0;</span></span></div><div class="line"><span class="text"><span>val&#xA0;ask_if_hugs&#xA0;:&#xA0;&apos;a&#xA0;t&#xA0;-&gt;&#xA0;&apos;a&#xA0;t</span></span></div><div class="line"><span class="text"><span>&#xA0;</span></span></div><div class="line"><span class="text"><span>(*&#xA0;maybe_hug&#xA0;kh&#xA0;ke&#xA0;ku&#xA0;h</span></span></div><div class="line"><span class="text"><span>&#xA0;&#xA0;&#xA0;Given&#xA0;a&#xA0;Huggable.t&#xA0;h&#xA0;and&#xA0;three&#xA0;continuations:</span></span></div><div class="line"><span class="text"><span>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;kh&#xA0;is&#xA0;a&#xA0;continuation&#xA0;called&#xA0;with&#xA0;h&apos;s&#xA0;value&#xA0;if&#xA0;h&#xA0;is&#xA0;huggable</span></span></div><div class="line"><span class="text"><span>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;ke&#xA0;is&#xA0;a&#xA0;continuation&#xA0;called&#xA0;with&#xA0;h&apos;s&#xA0;value&#xA0;if&#xA0;h&#xA0;is&#xA0;empathetic</span></span></div><div class="line"><span class="text"><span>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;ku&#xA0;is&#xA0;a&#xA0;continuation&#xA0;called&#xA0;with&#xA0;h&apos;s&#xA0;value&#xA0;if&#xA0;you&#xA0;haven&apos;t&#xA0;asked&#xA0;h&#xA0;recently</span></span></div><div class="line"><span class="text"><span>&#xA0;&#xA0;&#xA0;Applies&#xA0;the&#xA0;appropriate&#xA0;continuation&#xA0;and&#xA0;returns&#xA0;the&#xA0;result.&#xA0;*)</span></span></div><div class="line"><span class="text"><span>&#xA0;</span></span></div><div class="line"><span class="text"><span>val&#xA0;maybe_hug&#xA0;:&#xA0;(&apos;a&#xA0;-&gt;&#xA0;&apos;b)&#xA0;-&gt;&#xA0;(&apos;a&#xA0;-&gt;&#xA0;&apos;b)&#xA0;-&gt;&#xA0;(&apos;a&#xA0;-&gt;&#xA0;&apos;b)&#xA0;-&gt;&#xA0;(&apos;a&#xA0;t&#xA0;-&gt;&#xA0;&apos;b)</span></span></div><div class="line"><span class="text"><span>&#xA0;</span></span></div></pre>
<h6 id="user-content-testml" class="deep-link"><a href="#testml">test.ml</a></h6>
<pre class="editor editor-colors"><div class="line"><span class="text"><span>let&#xA0;t0&#xA0;=&#xA0;Unix.time&#xA0;()</span></span></div><div class="line"><span class="text"><span>&#xA0;</span></span></div><div class="line"><span class="text"><span>let&#xA0;print_t&#xA0;f&#xA0;x&#xA0;=&#xA0;begin</span></span></div><div class="line"><span class="text"><span>&#xA0;&#xA0;Printf.printf&#xA0;&quot;(T+%d):&#xA0;&quot;&#xA0;(int_of_float&#xA0;(Unix.time&#xA0;()&#xA0;-.&#xA0;t0));</span></span></div><div class="line"><span class="text"><span>&#xA0;&#xA0;Printf.printf&#xA0;f&#xA0;x;</span></span></div><div class="line"><span class="text"><span>&#xA0;&#xA0;print_newline&#xA0;();</span></span></div><div class="line"><span class="text"><span>&#xA0;&#xA0;flush&#xA0;stdout</span></span></div><div class="line"><span class="text"><span>end</span></span></div><div class="line"><span class="text"><span>&#xA0;</span></span></div><div class="line"><span class="text"><span>let&#xA0;try_hug&#xA0;=</span></span></div><div class="line"><span class="text"><span>&#xA0;&#xA0;Huggable.maybe_hug</span></span></div><div class="line"><span class="text"><span>&#xA0;&#xA0;&#xA0;&#xA0;(print_t&#xA0;&quot;Hugs&#xA0;for&#xA0;%s!&quot;)</span></span></div><div class="line"><span class="text"><span>&#xA0;&#xA0;&#xA0;&#xA0;(print_t&#xA0;&quot;Empathy&#xA0;for&#xA0;%s.&quot;)</span></span></div><div class="line"><span class="text"><span>&#xA0;&#xA0;&#xA0;&#xA0;(print_t&#xA0;&quot;You&#xA0;should&#xA0;first&#xA0;ask&#xA0;%s&#xA0;about&#xA0;hugs.&quot;)</span></span></div><div class="line"><span class="text"><span>&#xA0;</span></span></div><div class="line"><span class="text"><span>let&#xA0;try_ask&#xA0;p&#xA0;=</span></span></div><div class="line"><span class="text"><span>&#xA0;&#xA0;let&#xA0;p&#xA0;=&#xA0;Huggable.ask_if_hugs&#xA0;p&#xA0;in</span></span></div><div class="line"><span class="text"><span>&#xA0;&#xA0;let&#xA0;ka&#xA0;=&#xA0;print_t&#xA0;&quot;You&#xA0;asked&#xA0;%s&#xA0;about&#xA0;hugs!&quot;&#xA0;in&#xA0;begin</span></span></div><div class="line"><span class="text"><span>&#xA0;&#xA0;&#xA0;&#xA0;Huggable.maybe_hug&#xA0;ka&#xA0;ka&#xA0;ka&#xA0;p;</span></span></div><div class="line"><span class="text"><span>&#xA0;&#xA0;&#xA0;&#xA0;p</span></span></div><div class="line"><span class="text"><span>&#xA0;&#xA0;end</span></span></div><div class="line"><span class="text"><span>&#xA0;</span></span></div><div class="line"><span class="text"><span>let&#xA0;p1&#xA0;=&#xA0;Huggable.make&#xA0;&quot;Anne&quot;</span></span></div><div class="line"><span class="text"><span>let&#xA0;p2&#xA0;=&#xA0;Huggable.make&#xA0;&quot;Mister&#xA0;X&quot;</span></span></div><div class="line"><span class="text"><span>&#xA0;</span></span></div><div class="line"><span class="text"><span>let&#xA0;t0&#xA0;=&#xA0;Unix.time&#xA0;()</span></span></div><div class="line"><span class="text"><span>let&#xA0;_&#xA0;=&#xA0;try_hug&#xA0;p1</span></span></div><div class="line"><span class="text"><span>let&#xA0;_&#xA0;=&#xA0;try_hug&#xA0;p2</span></span></div><div class="line"><span class="text"><span>let&#xA0;p1&#xA0;=&#xA0;try_ask&#xA0;p1</span></span></div><div class="line"><span class="text"><span>let&#xA0;_&#xA0;=&#xA0;try_hug&#xA0;p1</span></span></div><div class="line"><span class="text"><span>let&#xA0;_&#xA0;=&#xA0;try_hug&#xA0;p2</span></span></div><div class="line"><span class="text"><span>let&#xA0;_&#xA0;=&#xA0;Unix.sleep&#xA0;10</span></span></div><div class="line"><span class="text"><span>let&#xA0;p2&#xA0;=&#xA0;try_ask&#xA0;p2</span></span></div><div class="line"><span class="text"><span>let&#xA0;_&#xA0;=&#xA0;try_hug&#xA0;p1</span></span></div><div class="line"><span class="text"><span>let&#xA0;_&#xA0;=&#xA0;try_hug&#xA0;p2</span></span></div><div class="line"><span class="text"><span>let&#xA0;_&#xA0;=&#xA0;Unix.sleep&#xA0;25</span></span></div><div class="line"><span class="text"><span>let&#xA0;_&#xA0;=&#xA0;try_hug&#xA0;p1</span></span></div><div class="line"><span class="text"><span>let&#xA0;_&#xA0;=&#xA0;try_hug&#xA0;p2</span></span></div><div class="line"><span class="text"><span>&#xA0;</span></span></div></pre>

    </main>
  </div>
  <footer>
    <a href="https://github.com/zkat/maybe-hugs">
      <span class="mega-octicon octicon-mark-github"></span>
    </a>
    <a href="http://creativecommons.org/publicdomain/zero/1.0/">
      <img src="https://camo.githubusercontent.com/c5160f944848828fa33126d9a697e9abe43ea98f/687474703a2f2f692e6372656174697665636f6d6d6f6e732e6f72672f702f7a65726f2f312e302f38387833312e706e67"/>
    </a>
</footer>
<script src="bundle.js"></script>
</body>
